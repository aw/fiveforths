<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
  <meta name="generator" content="Jekyll">

  <title>Devlog 5 Testing The Implementation</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico">

  <link rel="stylesheet" href="/css/main.css">
  
  <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="ATOM Feed" />
</head>

<body>
  <div id="wrapper">
    <header>
  <div>
    <a href="/">
    
      <h1>FiveForths</h1>
    </a>
    <p style="text-align: center;">32-bit RISC-V Forth for microcontrollers</p>
    <div class="header-links">
      <a href="https://github.com/aw/fiveforths"><h2 class="header-link">Code</h2></a>
<a href="/archive"><h2 class="header-link">Archive</h2></a>
<a href="/atom.xml"><h2 class="header-link">RSS</h2></a>
<a href="https://github.com/aw/fiveforths/archive/refs/heads/master.zip"><h2 class="header-link">Download</h2></a>
    </div>
  </div>
</header>
    <div class="container">
      <section id="main_content">
        <article>
  <h2>Devlog 5 Testing The Implementation</h2>
  <h1 id="november-19-2022">November 19, 2022</h1>

<ol>
  <li><a href="#testing-the-implementation">Testing the implementation</a></li>
  <li><a href="#log-5">Log 5</a></li>
  <li><a href="#loading_the_elf_program">Loading the ELF program</a></li>
  <li><a href="#closing-thoughts">Closing Thoughts</a></li>
</ol>

<h2 id="testing-the-implementation">Testing the implementation</h2>

<p>One of my favourite RISC-V simulators is called <a href="https://github.com/mortbopet/Ripes">Ripes</a>, it is open source and runs entirely offline from a single <em>AppImage</em> file. It’s perfect for testing and single-stepping through an ELF program and visually observing the registers and memory addresses.</p>

<h3 id="log-5">Log 5</h3>

<p>I wanted to use <em>Ripes</em> but I realized it would be easier to log output through GDB, so let’s start there.</p>

<h4 id="loading-the-elf-program">Loading the ELF program</h4>

<p>First we’ll want to load the ELF program into qemu:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>qemu-system-riscv32 -machine sifive_e -kernel fiveforths.elf -S -s
</code></pre></div></div>

<p>In another terminal, we’ll run GDB and ensure to load our program in QEMU.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Reading symbols from fiveforths.elf...
(gdb) target remote :1234
Remote debugging using :1234
0x00001004 in ?? ()
(gdb) info reg pc
pc             0x1004	0x1004
(gdb) load
Loading section .text, size 0x290 lma 0x8000000
Start address 0x08000048, load size 656
Transfer rate: 5248 bits in &lt;1 sec, 656 bytes/write.
(gdb) info reg pc
pc             0x8000048	0x8000048 &lt;_start&gt;
</code></pre></div></div>

<p>That’s better, but since the Assembly code is incomplete and we’re not running it on the <em>Longan Nano Lite</em>, we won’t be able to access memory at that address (0x8000048), so we won’t be able to step through the program… unless I missed something?</p>

<p>You can confirm that it works in <em>Ripes</em> where the first two instructions load <code class="language-plaintext highlighter-rouge">__stacktop</code> into the <code class="language-plaintext highlighter-rouge">sp</code> register and then the program stops.</p>

<p>There might be some relocation necessary if I want to successfully test this program in qemu/gdb, but for now this is acceptable until I physically connect the MCU.</p>

<h4 id="closing-thoughts">Closing thoughts</h4>

<p>This was a relatively short session with no changes to the source code, so in the next one I’ll jump right into coding the missing words.</p>

  <div class="pagination">
    
      <a class="prev" href="/devlog-4-validating-the-implementation">&laquo; Devlog 4 Validating The Implementation</a>
    
    
      <a class="next" href="/devlog-6-simpler-code">Devlog 6 Simpler Code &raquo;</a>
    
  </div>
</article>
      </section>
    </div>
  </div>

   <footer>
  <span>Copyright (c) 2021~ <a href="https://a1w.ca">Alexander Williams</a> and licensed under the permissive open source <a href="https://opensource.org/licenses/MIT">MIT</a> license.
  </span>
</footer>

</body>

</html>